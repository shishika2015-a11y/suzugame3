<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚¯ã‚¤ã‚ºã‚²ãƒ¼ãƒ  å®Œå…¨ç‰ˆ</title>

<style>
body{
  margin:0;
  font-family: Meiryo, sans-serif;
  text-align:center;
  background:#eef6ff;
}

/* ç”»é¢ */
#game, #result { display:none; }

/* å•é¡Œ */
#question{
  font-size:22px;
  margin:15px;
  padding:15px;
  background:#fff;
  border-radius:12px;
}
.flash{ background:#ffb3b3 !important; }

/* é¸æŠè‚¢ï¼ˆã‚¹ãƒãƒ›æœ€é©åŒ–ï¼‰ */
.choice{
  display:block;
  margin:12px auto;
  padding:16px;
  width:90%;
  max-width:320px;
  font-size:18px;
  border:none;
  border-radius:12px;
  background:#fff;
  cursor:pointer;
  touch-action:manipulation;
}

/* ãƒœã‚¿ãƒ³ */
button{
  margin:6px;
  padding:12px 18px;
  font-size:16px;
  border:none;
  border-radius:10px;
  cursor:pointer;
}

/* ã‚¹ã‚³ã‚¢ */
.scoreBox{
  font-size:14px;
  margin-bottom:10px;
}
</style>
</head>

<body>

<!-- ===== ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ ===== -->
<div id="start">
  <h1>â˜… ã‚¯ã‚¤ã‚ºã‚²ãƒ¼ãƒ  â˜…</h1>

  <button onclick="setLevel('easy')">ğŸ˜Š ã‹ã‚“ãŸã‚“</button>
  <div class="scoreBox">
    æœ€é«˜ï¼š<span id="hs_easy">0</span>
    ï¼ ã‚¯ãƒªã‚¢ç‡ï¼š<span id="rate_easy">0</span>%
  </div>

  <button onclick="setLevel('normal')">ğŸ™‚ ãµã¤ã†</button>
  <div class="scoreBox">
    æœ€é«˜ï¼š<span id="hs_normal">0</span>
    ï¼ ã‚¯ãƒªã‚¢ç‡ï¼š<span id="rate_normal">0</span>%
  </div>

  <button onclick="setLevel('hard')">ğŸ˜ˆ ã‚€ãšã‹ã—ã„</button>
  <div class="scoreBox">
    æœ€é«˜ï¼š<span id="hs_hard">0</span>
    ï¼ ã‚¯ãƒªã‚¢ç‡ï¼š<span id="rate_hard">0</span>%
  </div>
</div>

<!-- ===== ã‚²ãƒ¼ãƒ ç”»é¢ ===== -->
<div id="game">
  <div id="question"></div>

  <button class="choice" onclick="answer(0)"></button>
  <button class="choice" onclick="answer(1)"></button>
  <button class="choice" onclick="answer(2)"></button>

  <p>
    ãƒã‚¤ãƒ³ãƒˆï¼š<span id="point">0</span> /
    <span id="maxPoint">0</span><br>
    ãƒŸã‚¹ï¼š<span id="miss">0</span> /
    <span id="maxMiss">0</span><br>
    ã®ã“ã‚Šï¼š<span id="time">0</span> ç§’
  </p>
</div>

<!-- ===== çµæœç”»é¢ ===== -->
<div id="result">
  <h2 id="resultText"></h2>
  <button onclick="backToStart()">ã‚‚ã©ã‚‹</button>
</div>

<script>
/* ===== å•é¡Œãƒ‡ãƒ¼ã‚¿ ===== */
const QUIZ = {/* â† ã‚ãªãŸã®å…ƒãƒ‡ãƒ¼ã‚¿ã‚’ãã®ã¾ã¾ä½¿ç”¨ */};
</script>

<script>
/* ===== è¨­å®š ===== */
const LEVELS={
  easy:{time:12,maxMiss:5},
  normal:{time:10,maxMiss:3},
  hard:{time:7,maxMiss:2}
};

const highScores={
  easy:Number(localStorage.getItem("highScore_easy"))||0,
  normal:Number(localStorage.getItem("highScore_normal"))||0,
  hard:Number(localStorage.getItem("highScore_hard"))||0
};

const stats={
  easy:{play:Number(localStorage.getItem("play_easy"))||0,clear:Number(localStorage.getItem("clear_easy"))||0},
  normal:{play:Number(localStorage.getItem("play_normal"))||0,clear:Number(localStorage.getItem("clear_normal"))||0},
  hard:{play:Number(localStorage.getItem("play_hard"))||0,clear:Number(localStorage.getItem("clear_hard"))||0}
};

/* ===== å…±é€š ===== */
let levelKey,level,quizOrder,index,point,miss,timeLeft,timer,current;

/* ã‚·ãƒ£ãƒƒãƒ•ãƒ« */
function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
}

/* ã‚¯ãƒªã‚¢ç‡ */
function updateRate(k){
  const p=stats[k].play,c=stats[k].clear;
  document.getElementById(`rate_${k}`).textContent=p?Math.round(c/p*100):0;
}

["easy","normal","hard"].forEach(k=>{
  document.getElementById(`hs_${k}`).textContent=highScores[k];
  updateRate(k);
});

/* ===== ã‚²ãƒ¼ãƒ é–‹å§‹ ===== */
function setLevel(k){
  levelKey=k;
  level=LEVELS[k];
  stats[k].play++;
  localStorage.setItem(`play_${k}`,stats[k].play);
  updateRate(k);

  quizOrder=[...QUIZ[k]];
  shuffle(quizOrder);
  index=0; point=0; miss=0;

  document.getElementById("maxPoint").textContent=quizOrder.length;
  document.getElementById("maxMiss").textContent=level.maxMiss;
  document.getElementById("point").textContent=0;
  document.getElementById("miss").textContent=0;

  document.getElementById("start").style.display="none";
  document.getElementById("game").style.display="block";
  nextQuestion();
}

function nextQuestion(){
  clearInterval(timer);
  if(index>=quizOrder.length){
    stats[levelKey].clear++;
    localStorage.setItem(`clear_${levelKey}`,stats[levelKey].clear);
    updateRate(levelKey);
    endGame(`ğŸ‰ ã‚¯ãƒªã‚¢ï¼ ${point}/${quizOrder.length}`);
    return;
  }
  current=quizOrder[index++];
  timeLeft=level.time;
  document.getElementById("time").textContent=timeLeft;
  const q=document.getElementById("question");
  q.classList.remove("flash");
  q.textContent=current.q;
  document.querySelectorAll(".choice").forEach((b,i)=>b.textContent=current.c[i]);
  timer=setInterval(countDown,1000);
}

function countDown(){
  timeLeft--;
  document.getElementById("time").textContent=timeLeft;
  if(timeLeft<=3)document.getElementById("question").classList.toggle("flash");
  if(timeLeft<=0){clearInterval(timer);miss++;document.getElementById("miss").textContent=miss;check();}
}

function answer(i){
  clearInterval(timer);
  if(i===current.a){point++;document.getElementById("point").textContent=point;}
  else{miss++;document.getElementById("miss").textContent=miss;}
  check();
}

function check(){
  if(miss>=level.maxMiss)endGame("ğŸ’¥ ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ ğŸ’¥");
  else nextQuestion();
}

function endGame(text){
  if(point>highScores[levelKey]){
    highScores[levelKey]=point;
    localStorage.setItem(`highScore_${levelKey}`,point);
    document.getElementById(`hs_${levelKey}`).textContent=point;
  }
  document.getElementById("game").style.display="none";
  document.getElementById("result").style.display="block";
  document.getElementById("resultText").textContent=text;
}

function backToStart(){
  document.getElementById("result").style.display="none";
  document.getElementById("start").style.display="block";
}
</script>

</body>
</html>
