<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚¯ã‚¤ã‚ºã‚²ãƒ¼ãƒ  å®Œå…¨ç‰ˆ</title>
<style>
body {
  font-family: Meiryo, sans-serif;
  text-align: center;
  background: #eef6ff;
}
#game, #result { display: none; }
.choice {
  display: block;
  margin: 10px auto;
  padding: 15px;
  width: 240px;
  font-size: 16px;
  cursor: pointer;
}
#question {
  font-size: 24px;
  margin: 20px;
  padding: 20px;
  background: white;
}
.flash { background: #ff9999 !important; }
.scoreBox { font-size: 14px; margin-bottom: 10px; }
</style>
</head>

<body>

<!-- ===== ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ ===== -->
<div id="start">
  <h1>â˜… ã‚¯ã‚¤ã‚ºã‚²ãƒ¼ãƒ  â˜…</h1>

  <button onclick="setLevel('easy')">ğŸ˜Š ã‹ã‚“ãŸã‚“</button>
  <div class="scoreBox">
    æœ€é«˜ï¼š<span id="hs_easy">0</span>ã€€
    ã‚¯ãƒªã‚¢ç‡ï¼š<span id="rate_easy">0</span>%
  </div>

  <button onclick="setLevel('normal')">ğŸ™‚ ãµã¤ã†</button>
  <div class="scoreBox">
    æœ€é«˜ï¼š<span id="hs_normal">0</span>ã€€
    ã‚¯ãƒªã‚¢ç‡ï¼š<span id="rate_normal">0</span>%
  </div>

  <button onclick="setLevel('hard')">ğŸ˜ˆ ã‚€ãšã‹ã—ã„</button>
  <div class="scoreBox">
    æœ€é«˜ï¼š<span id="hs_hard">0</span>ã€€
    ã‚¯ãƒªã‚¢ç‡ï¼š<span id="rate_hard">0</span>%
  </div>
</div>

<!-- ===== ã‚²ãƒ¼ãƒ ç”»é¢ ===== -->
<div id="game">
  <div id="question"></div>
  <button class="choice" onclick="answer(0)"></button>
  <button class="choice" onclick="answer(1)"></button>
  <button class="choice" onclick="answer(2)"></button>

  <p>
    ãƒã‚¤ãƒ³ãƒˆï¼š<span id="point">0</span> /
    <span id="maxPoint">0</span>ã€€
    ãƒŸã‚¹ï¼š<span id="miss">0</span> /
    <span id="maxMiss">0</span>ã€€
    ã®ã“ã‚Šï¼š<span id="time">0</span> ç§’
  </p>
</div>

<!-- ===== çµæœç”»é¢ ===== -->
<div id="result">
  <h2 id="resultText"></h2>
  <button onclick="backToStart()">ã‚‚ã©ã‚‹</button>
</div>

<script>
/* ===== å•é¡Œãƒ‡ãƒ¼ã‚¿ï¼ˆå„20å•ï¼‰===== */
const QUIZ = {
easy: [
  {q:"ã‚Šã‚“ã”ã®è‰²ã¯ï¼Ÿ",c:["ã‚ã‹","ã‚ãŠ","ã¿ã©ã‚Š"],a:0},
  {q:"ã­ã“ã®é³´ãå£°ã¯ï¼Ÿ",c:["ã‚ã‚“","ã«ã‚ƒãƒ¼","ã´ã‚ˆ"],a:1},
  {q:"1é€±é–“ã¯ä½•æ—¥ï¼Ÿ",c:["5","7","10"],a:1},
  {q:"ç©ºã®è‰²ã¯ï¼Ÿ",c:["ã‚ãŠ","ã‚ã‹","ãã‚"],a:0},
  {q:"æ°´ã¯ä½•è‰²ï¼Ÿ",c:["ã‚ãŠ","ã¨ã†ã‚ã„","ã—ã‚"],a:1},
  {q:"çŠ¬ã®é³´ãå£°ã¯ï¼Ÿ",c:["ã‚‚ãƒ¼","ã‚ã‚“","ã«ã‚ƒãƒ¼"],a:1},
  {q:"å¤ªé™½ã¯ã©ã‚Œï¼Ÿ",c:["â­","â˜€ï¸","ğŸŒ™"],a:1},
  {q:"2+3ã¯ï¼Ÿ",c:["4","5","6"],a:1},
  {q:"æ—¥æœ¬ã®ãŠé‡‘ã¯ï¼Ÿ",c:["å††","ãƒ‰ãƒ«","ãƒ¦ãƒ¼ãƒ­"],a:0},
  {q:"æœã«é£Ÿã¹ã‚‹ã®ã¯ï¼Ÿ",c:["å¤œ","æœ","æ˜¼"],a:1},
  {q:"é›ªã®è‰²ã¯ï¼Ÿ",c:["ã—ã‚","ã‚ãŠ","ãã‚"],a:0},
  {q:"ã­ã“ã¯ä½•æœ¬è¶³ï¼Ÿ",c:["2","4","6"],a:1},
  {q:"æ˜¥ã«ã•ãèŠ±ã¯ï¼Ÿ",c:["ã•ãã‚‰","ã²ã¾ã‚ã‚Š","ã°ã‚‰"],a:0},
  {q:"é­šã¯ã©ã“ï¼Ÿ",c:["ãã‚‰","ã¿ãš","ã‚„ã¾"],a:1},
  {q:"ãƒãƒŠãƒŠã®è‰²ã¯ï¼Ÿ",c:["ãã„ã‚","ã‚ã‹","ã‚ãŠ"],a:0},
  {q:"å¤œã«ã­ã‚‹ï¼Ÿ",c:["ã­ã‚‹","ãŸã¹ã‚‹","ã¯ã—ã‚‹"],a:0},
  {q:"æ—¥æœ¬ã®å›½æ——ã®è‰²ã¯ï¼Ÿ",c:["ã‚ã‹ã¨ã—ã‚","ã‚ãŠã¨ã—ã‚","ãã‚ã¨ã—ã‚"],a:0},
  {q:"ãƒãƒ§ã‚³ã¯ï¼Ÿ",c:["ã‚ã¾ã„","ã‹ã‚‰ã„","ã«ãŒã„"],a:0},
  {q:"æœã®ã‚ã„ã•ã¤ã¯ï¼Ÿ",c:["ãŠã¯ã‚ˆã†","ã“ã‚“ã°ã‚“ã¯","ã•ã‚ˆãªã‚‰"],a:0},
  {q:"ç©ºã‚’ã¨ã¶ã®ã¯ï¼Ÿ",c:["ã¨ã‚Š","ã„ã¬","ã•ã‹ãª"],a:0}
],

normal: [
  {q:"5+7ã¯ï¼Ÿ",c:["10","11","12"],a:2},
  {q:"æ—¥æœ¬ã®é¦–éƒ½ã¯ï¼Ÿ",c:["å¤§é˜ª","æ±äº¬","äº¬éƒ½"],a:1},
  {q:"3Ã—4ã¯ï¼Ÿ",c:["7","12","9"],a:1},
  {q:"1å¹´ã¯ä½•ã‹æœˆï¼Ÿ",c:["10","12","15"],a:1},
  {q:"å¤œã«å‡ºã‚‹ã®ã¯ï¼Ÿ",c:["å¤ªé™½","æœˆ","é›²"],a:1},
  {q:"6Ã·2ã¯ï¼Ÿ",c:["2","3","4"],a:1},
  {q:"æ—¥æœ¬ã§ä¸€ç•ªé«˜ã„å±±ã¯ï¼Ÿ",c:["å¯Œå£«å±±","é«˜å°¾å±±","ç­‘æ³¢å±±"],a:0},
  {q:"é›¨ã®ã‚ã¨ã«å‡ºã‚‹ã®ã¯ï¼Ÿ",c:["æ˜Ÿ","è™¹","é›ª"],a:1},
  {q:"æ˜¥ã®æ¬¡ã®å­£ç¯€ã¯ï¼Ÿ",c:["å¤","ç§‹","å†¬"],a:0},
  {q:"10ã®æ¬¡ã¯ï¼Ÿ",c:["9","11","20"],a:1},
  {q:"8+6ã¯ï¼Ÿ",c:["12","14","16"],a:1},
  {q:"4Ã—5ã¯ï¼Ÿ",c:["10","20","25"],a:1},
  {q:"1æ™‚é–“ã¯ä½•åˆ†ï¼Ÿ",c:["30","60","90"],a:1},
  {q:"æ—¥æœ¬ã®æ–‡å­—ã¯ï¼Ÿ",c:["ã²ã‚‰ãŒãª","ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆ","ãƒ­ãƒ¼ãƒå­—"],a:0},
  {q:"æµ·ã®è‰²ã¯ï¼Ÿ",c:["ã‚ãŠ","ã¿ã©ã‚Š","ãã‚"],a:0},
  {q:"7+8ã¯ï¼Ÿ",c:["14","15","16"],a:1},
  {q:"æ˜¼ã«å‡ºã‚‹ã®ã¯ï¼Ÿ",c:["æœˆ","å¤ªé™½","æ˜Ÿ"],a:1},
  {q:"ç§‹ã«é£Ÿã¹ã‚‹æœç‰©ã¯ï¼Ÿ",c:["ã™ã„ã‹","ã‚Šã‚“ã”","ã„ã¡ã”"],a:1},
  {q:"ä¿¡å·ã®é’ã¯ï¼Ÿ",c:["ã™ã™ã‚","ã¨ã¾ã‚Œ","ã‚‚ã©ã‚Œ"],a:0},
  {q:"æ—¥æœ¬ã®å®¶ã«ã‚ã‚‹ã®ã¯ï¼Ÿ",c:["ãŸãŸã¿","ã‚½ãƒ•ã‚¡","ãƒ™ãƒƒãƒ‰"],a:0}
],

hard: [
  {q:"9âˆ’4ã¯ï¼Ÿ",c:["3","4","5"],a:2},
  {q:"8Ã—7ã¯ï¼Ÿ",c:["54","56","64"],a:1},
  {q:"15Ã·3ã¯ï¼Ÿ",c:["3","4","5"],a:2},
  {q:"100âˆ’37ã¯ï¼Ÿ",c:["63","67","73"],a:0},
  {q:"1kmã¯ä½•mï¼Ÿ",c:["100","500","1000"],a:2},
  {q:"æ­£ä¸‰è§’å½¢ã®è¾ºã¯ï¼Ÿ",c:["2","3","4"],a:1},
  {q:"12Ã—6ã¯ï¼Ÿ",c:["66","72","78"],a:1},
  {q:"50Ã·5ã¯ï¼Ÿ",c:["5","10","15"],a:1},
  {q:"9Ã—9ã¯ï¼Ÿ",c:["72","81","99"],a:1},
  {q:"7Ã—8ã¯ï¼Ÿ",c:["54","56","64"],a:1},
  {q:"144Ã·12ã¯ï¼Ÿ",c:["10","11","12"],a:2},
  {q:"1æ—¥ã¯ä½•æ™‚é–“ï¼Ÿ",c:["12","24","48"],a:1},
  {q:"è§’ãŒ4ã¤ã‚ã‚‹å›³å½¢ã¯ï¼Ÿ",c:["ä¸‰è§’å½¢","å››è§’å½¢","å††"],a:1},
  {q:"1000âˆ’458ã¯ï¼Ÿ",c:["542","552","562"],a:0},
  {q:"6Ã—9ã¯ï¼Ÿ",c:["45","54","63"],a:1},
  {q:"0ã§å‰²ã‚‹ã¨ï¼Ÿ",c:["0","ã§ããªã„","1"],a:1},
  {q:"360åº¦ã¯ï¼Ÿ",c:["åŠå‘¨","1å‘¨","2å‘¨"],a:1},
  {q:"5Â²ã¯ã„ãã¤ï¼Ÿ",c:["10","25","30"],a:1},
  {q:"å¶æ•°ã¯ï¼Ÿ",c:["7","9","12"],a:2},
  {q:"ç´ æ•°ã¯ï¼Ÿ",c:["4","6","7"],a:2}
]
};

/* ===== è¨­å®š ===== */
const LEVELS = {
  easy:{time:12,maxMiss:5},
  normal:{time:10,maxMiss:3},
  hard:{time:7,maxMiss:2}
};

const highScores = {
  easy: Number(localStorage.getItem("highScore_easy")) || 0,
  normal: Number(localStorage.getItem("highScore_normal")) || 0,
  hard: Number(localStorage.getItem("highScore_hard")) || 0
};

const stats = {
  easy:{play:Number(localStorage.getItem("play_easy"))||0,clear:Number(localStorage.getItem("clear_easy"))||0},
  normal:{play:Number(localStorage.getItem("play_normal"))||0,clear:Number(localStorage.getItem("clear_normal"))||0},
  hard:{play:Number(localStorage.getItem("play_hard"))||0,clear:Number(localStorage.getItem("clear_hard"))||0}
};

/* ===== å…±é€š ===== */
let levelKey,level,quizOrder,index,point,miss,timeLeft,timer,current;

function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
}

function updateRate(k){
  const p=stats[k].play,c=stats[k].clear;
  document.getElementById(`rate_${k}`).textContent=p?Math.round(c/p*100):0;
}

["easy","normal","hard"].forEach(k=>{
  document.getElementById(`hs_${k}`).textContent=highScores[k];
  updateRate(k);
});

/* ===== ã‚²ãƒ¼ãƒ  ===== */
function setLevel(k){
  levelKey=k; level=LEVELS[k];
  stats[k].play++;
  localStorage.setItem(`play_${k}`,stats[k].play);
  updateRate(k);

  quizOrder=[...QUIZ[k]];
  shuffle(quizOrder);
  index=0; point=0; miss=0;

  document.getElementById("maxPoint").textContent=quizOrder.length;
  document.getElementById("maxMiss").textContent=level.maxMiss;
  document.getElementById("point").textContent=0;
  document.getElementById("miss").textContent=0;

  document.getElementById("start").style.display="none";
  document.getElementById("game").style.display="block";
  nextQuestion();
}

function nextQuestion(){
  clearInterval(timer);
  if(index>=quizOrder.length){
    stats[levelKey].clear++;
    localStorage.setItem(`clear_${levelKey}`,stats[levelKey].clear);
    updateRate(levelKey);
    endGame(`ğŸ‰ ã‚¯ãƒªã‚¢ï¼ ${point}/${quizOrder.length}`);
    return;
  }
  current=quizOrder[index++];
  timeLeft=level.time;
  document.getElementById("time").textContent=timeLeft;
  document.getElementById("question").classList.remove("flash");
  document.getElementById("question").textContent=current.q;
  document.querySelectorAll(".choice").forEach((b,i)=>b.textContent=current.c[i]);
  timer=setInterval(countDown,1000);
}

function countDown(){
  timeLeft--;
  document.getElementById("time").textContent=timeLeft;
  if(timeLeft<=3)document.getElementById("question").classList.toggle("flash");
  if(timeLeft<=0){clearInterval(timer);miss++;document.getElementById("miss").textContent=miss;check();}
}

function answer(i){
  clearInterval(timer);
  if(i===current.a){point++;document.getElementById("point").textContent=point;}
  else{miss++;document.getElementById("miss").textContent=miss;}
  check();
}

function check(){
  if(miss>=level.maxMiss)endGame("ğŸ’¥ ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ ğŸ’¥");
  else nextQuestion();
}

function endGame(text){
  if(point>highScores[levelKey]){
    highScores[levelKey]=point;
    localStorage.setItem(`highScore_${levelKey}`,point);
    document.getElementById(`hs_${levelKey}`).textContent=point;
  }
  document.getElementById("game").style.display="none";
  document.getElementById("result").style.display="block";
  document.getElementById("resultText").textContent=text;
}

function backToStart(){
  document.getElementById("result").style.display="none";
  document.getElementById("start").style.display="block";
}
</script>

</body>
</html>
